---
title: 随机数生成技术概述
date: 2022-10-05 22:02:34
tags:
---

随机数在安全技术中通常被用于生成随机序列，而要做到“完全随机”是非常困难的，一般需要满足3个条件：

1. 其必须是不可预知的
2. 其必须被均匀分布(即任何数均有平等出现的机会)
3. 其必须统计独立 (即与以前生成的随机数不存在明显关系)

## PRNG

## CRNG

## TRNG

---

美国国家标准和技术研究所(NIST)制定了随机数发生器的技术规范，称为`NIST SP 800 - 22`和`SP 800 - 90`，其推荐的技术路线是：真随机数生成器TRNG + 伪随机数生成器PRNG。

真随机数通常来源于硬件随机数生成器，每次生成的随机数都是真正的随机数，但是因为物理因素，生成的时间较慢。比如STM32中提供的RNG硬件外设。
随机数发生器(TRNG)从一些随机过程中收获熵(如:晶体管中电流产生的噪音，或放射性衰变事件之间的时间)，继而通过异或运算等方法消除随机位的概率偏差，最后输出高质量的随机数

伪随机数通常来源于某个生成算法，每次生成的随机数虽然是随机的，但还是遵循生成算法的规则，优点是生成速度较快。比如C库中提供的rand函数，在相同的种子下，其生成的随机数序列相同，所以称之为伪随机数。
PRNG（也叫做确定性随机数生成器，DRBG）的最佳输入设备就是高质量的TRNG，伪随机数所使用的种子就称为熵源（熵池）。

NIST SP 800-90A规范中描述了三种产生伪随机数的算法：

- Hash_DRBG：使用单向散列算法作为伪随机数生成的基础算法；
- HMAC_DRBG：使用消息认证码算法作为随机数生成的基础算法；
- CTR_DRBG：使用分组密码算法的计数器模式作为随机数生成的基础算法（重点）。

CTR-DRBG 可以理解为一个AES加密过程，通过利用分组密码算法对一个递增的计数器进行加密来产生期望随机数序列，分组密码算法可以是3DES(64bits)，AES(128, 192, 256bits)。

熵源
内核 CPRNG 源自启动过程中的多个熵源并存在于设备的整个生命周期。 这些来源包括 (取决于可用性):
• 安全隔区硬件 TRNG
• 启动过程中所收集基于时序的时间误差
• 从硬件中断收集的熵
• 用于启动过程中保持熵的种子文件
• Intel 随机指令， 例如 RDSEED 和 RDRAND (仅限基于 Intel 的 Mac)

内核 CPRNG
内核 CPRNG 的设计源自 Fortuna 算法， 旨在满足 256 位安全级别。 它使用以下 API 为用户空间使用者
提供高质量的随机数 :
• getentropy(2) 系统调用
• 随机设备 (/dev/random)
内核 CPRNG 通过写入随机设备接受用户提供的熵。

---

## 参考文献

### 技术分析

- [写给开发人员的实用密码学（一）—— 概览](https://thiscute.world/posts/practical-cryptography-basics-1/)
- [写给开发人员的实用密码学（四）—— 安全随机数生成器 CSPRNG](https://thiscute.world/posts/practical-cryptography-basics-4-secure-random-generators/)
- [CTR-DRBG的缓存侧信道攻击方法](https://securitygossip.com/blog/2020/03/16/pseudorandom-black-swans-cache-attacks-on-ctr-drbg/)
- [加盐密码哈希：如何正确使用](https://www.tomczhen.com/2016/10/10/hashing-security/)
- [伪随机数生成器（ctr_drbg）的配置与使用](https://blog.51cto.com/u_13640625/3027985)
- [随机数发生器设计原理及实现](https://blog.csdn.net/a00553344/article/details/3978312)
- [正确认识随机数 - 北京车牌摇号的算法是公平的](https://ms2008.github.io/2017/10/24/PRNG/)
- [密码加密存储技术详解](https://www.ujcms.com/knowledge/509.html)

### 文档下载

- [基于多级反馈环形振荡器的真随机数发生器设计](基于多级反馈环形振荡器的真随机数发生器设计.pdf)
- [安全系统的真随机数发生器](安全系统的真随机数发生器.pdf)
- [真随机数发生器的后处理方法](真随机数发生器的后处理方法.pdf)