---
title: VPC（虚拟私有云）的网络规划
date: 2021-06-26 23:07:16
tags:
---

虚拟私有云（Virtual Private Cloud，以下简称VPC，有的厂商也称为`私有网络`），是一个**用户自定义的**、**逻辑隔离**的虚拟网络环境，以提升用户云上资源的安全性，并满足不同的应用场景需求。

您可以在VPC中定义安全组、VPN、IP地址段、带宽等网络特性。用户可以通过VPC方便地管理、配置内部网络，进行安全、快捷的网络变更。同时，用户可以自定义安全组内与组间弹性云服务器的访问规则，加强弹性云服务器的安全保护。

VPC的基础基础架构如下图：

{% asset_img vpc-infra.png 典型 %}

## 核心组成部分

VPC有几个核心组成部分：私有网络网段、子网、路由表、接入控制列表、安全组。

### CIDR - 私有网络网段

用户在创建私有网络时，需要用 `CIDR`（无类别域间路由） 作为私有网络指定 IP 地址组。
私有网络`CIDR`支持使用如下私有网段中的任意一个：

- 10.0.0.0 - 10.255.255.255（掩码范围需在16 - 28之间）
- 172.16.0.0 - 172.31.255.255（掩码范围需在16 - 28之间）
- 192.168.0.0 - 192.168.255.255 （掩码范围需在16 - 28之间）

### Subnet - 子网

一个私有网络由至少一个子网组成，私有网络中的所有云资源（如云服务器、云数据库等）都必须部署在子网内，子网的 CIDR 必须在私有网络的 CIDR 内。

私有网络具有 地域（Region） 属性（如广州），而子网具有 可用区（Zone） 属性（如广州一区），您可以为私有网络划分一个或多个子网。
> - 同一VPC下，不同Subnet**默认内网互通**
> - 不同VPC之间，无论是否在同一地域，均**默认内网隔离**，但可通过创建**对等连接**实现互联互通

### Router - 路由表

路由表由一系列路由规则组成，用于控制虚拟私有云内子网的出流量走向。

VPC中的每个子网都必须关联一个路由表，一个子网一次只能关联一个路由表，但一个路由表可以关联多个子网。
> 用户创建私有网络时，系统会自动为其生成一个默认路由表，以保证同一个私有网络下的所有子网互通。
当然，您也可以创建自定义路由表。

### ACL（Access Control List） - 接入控制列表

网络 ACL 是一个子网级别的、无状态的包过滤虚拟防火墙，用于控制进出子网的数据流，可以精确到协议和端口粒度。

### Secruity Group - 安全组

安全组是一种有状态的包过滤虚拟防火墙，用于控制实例级别的出入流量，为同一个VPC内具有相同安全保护需求并相互信任的云服务器提供访问策略。

系统会为每个用户默认创建一个安全组，默认安全组的规则是在出方向上的数据报文全部放行，入方向访问受限，安全组内的云服务器无需添加规则即可互相访问。


{% asset_img vpc-map.png %}

{% asset_img vpc-desktop.png %}





## 参考文献

- [华为云的网络规划介绍](https://support.huaweicloud.com/eu-west-0-usermanual-vpc/vpc_0001.html)
- [AWS VPC网络部署参考](http://www.coding-daddy.com/other/aws-deploy.html#_1-vpc%E5%AE%9A%E4%B9%89)
- [Azure Bastion 堡垒机的介绍](https://blog.csdn.net/qq_24550639/article/details/109202811)
- [UCloud云平台的VPC部署案例](https://zhuanlan.zhihu.com/p/35130978?ivk_sa=1024320u)

- [使用Cloud Native的服务治理替换Spring Cloud](https://xie.infoq.cn/article/8062a35d680349a5ca364e36f)