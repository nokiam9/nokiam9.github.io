---
title: Wi-Fi 6的技术专题之三：关键技术
date: 2022-03-29 15:02:07
tags:
---

从理论上看，Wi-Fi的理论速率与以下因素密切相关：频宽、频率复用技术、调制方法、编码方案和天线数量等，可以表示为下面的公式：

{% asset_img rate.png %}

回顾整个 802.11 协议标准的发展历程，每一代新的协议都在与3GPP的移动通信技术相互借鉴，传输速率和数据吞吐率方面有着较大的提升，尤其是演进到 802.11ac 协议后，无线网络带宽与有线差距越来越小，基本可以满足大部分应用的需求。但802.11ac 的最大速率6.9Gbps只是实验室环境的理论值，在实际应用场景的有效带宽远远低于理论值，且并发用户数越多，有效吞吐率就会越差。

802.11ax 的关键字是高效率无线标准（HEW，High-Efficiency Wireless），任务目标是：

- 进一步提高理论最大速率，从 802.11ac 的6.9Gbps提高到 9.6Gbps；
- 更重要的是，大幅度提高多用户并发效率，提供密集用户环境下4倍实际吞吐量的提升
- 以及，更好适应物联网等室外场景的应用。

从技术栈的角度看，Wi-Fi 6主要采用了以下优化技术，分别工作在PHY物理层和MAC链路层。
{% asset_img arch.png %}

## 一、OFDMA = 多用户的 OFDM

从 802.11a 开始直到 802.11ac，数据传输一直采用OFDM（正交频分复用）模式，单一信道被分成了多个子载波，每一个子载波是正交的，通过快速傅里叶变换（FFT）和快速傅里叶逆变换（IFFT）来构成的，不会互相干扰。
但是，在OFDM模式下，不同用户是通过不同时间片段区分出来的，因此对于每一个时间片段，一个用户完整占据所有的子载波并发送一个完整的数据包，因此如果某个用户发送的数据不多，频率资源用不满的情况下，其他用户只能干巴巴地排队等着，频谱资源的使用效率不高。

{% asset_img ofdm.png %}

为了解决这个问题，802.11ax 引入了OFDMA（正交频分复用多址）技术，后面多了个字母A代表多址，就是多用户复用的意思，也就是OFDM的多用户版本。
> 实际上，OFDMA技术来自于3GPP LTE，802.11ax就是简单抄袭过来的

具体实现方式是利用 OFDM 对信道进行父载波化，将同一个带宽下的所有子载波划分成若干个子载波组，每一个组被称作一个 RU（Resouce Unit，资源单元），可以同时分配给不同的用户使用，每一个时间片上可有多个用户同时发送，这样就提高了用户数据速率并减少了延迟，特别适用于大量具有短帧或低速率要求的设备，如物联网设备。
在 OFDMA 中，一个 OFDM 信号是由多个子载波组成，这些子载波就组成了一个用户自己的带宽，每个用户可分配的 RU 大小可以是不同的。

{% asset_img ofdma.png %}

与传统OFDM相比，OFDMA并不能显著提升单用户速率，但对于多用户并发将带来明显的优势：

- 更稳定的传输效率：在部分节点信道状态不太好的情况下，可以根据信道质量分配发送功率，来更精细化的分配信道时频资源
- 更短的传输延迟：因为 802.11ac 及之前的标准都是占据整个信道传输数据的，如果有一个 QOS 数据包需要发送，其一定要等之前的发送者释放完整个信道才行，所以会存在较长的时延。在OFDMA 模式下，由于一个发送者只占据整个信道的部分资源，一次可以发送多个用户的数据，所以能够减少 QOS 节点接入的时延
- 更高的用户并发度：OFDMA将整个信道资源划分成多个子载波，子载波又按不同 RU 类型被分成若干组，每个用户可以占用一组或多组 RU 以满足不同带宽需求的业务

## 二、DL MU-MIMO + UL MU-MIMO

路由器上面的天线数量是越来越多，现在不管啥价钱的路由器，都长得跟螃蟹似的，张牙舞爪好不唬人。为啥要用这么多天线？就是为了更好地实现MIMO（多输入多输出）技术。简单来说，就是在信号发射时，用多根天线来同时发送多路不同的数据，速度自然成倍提升；在接收时，多个天线同时接收手机发来的信号，跟戴了助听器一样，接收灵敏度也得到了增强。

在传统的SU-MIMO中，若具有多条空间流的路由器下同时连接了多个只支持单个空间流的设备，在它们同时下载时，路由器只能使用一条空间流轮流与这些设备通信，剩下的空间流均会被浪费。

### 下行 MU-MIMO

2016年推出的802.11ac wave2中，增加了MU-MIMO（Multi-User MIMO）的支持（仅下行方向），AP可以使用不同的空间流（天线）与不同的设备进行通信，从而带来多路复用增益，实现了对多用户下行并发场景性能的提升。

> MU-MIMO技术在制定之时，最多只允许3条流同时传输，如今更多手机均使用2x2MIMO，但两台这样的手机是无法激活MU-MIMO的。
> 而且，MU-MIMO仅会在多台均支持MU-MIMO的设备同时吞吐时才会生效，若无线网络中支持MU-MIMO的终端设备较少，其效果将会非常有限。

{% asset_img DL-MIMO.png %}

802.11ac 只支持DL 4x4 MU-MIMO（下行），在802.11ax中进一步增加了MU-MIMO数量，可支持DL 8x8 MU-MIMO，同时借助DL OFDMA技术（下行），可同时进行MU-MIMO传输和分配不同RU进行多用户多址传输，既增加了系统并发接入量，又均衡了吞吐量。
在信道评估阶段，802.11ax 使用 OFDMA 机制中的 trigger 方式来完成 AP 收集各 STA 的信道 CBF（Compressed Beamforming Feedback，压缩波束成形反馈信息）信息，进行信道质量评估。

### 上行 MU-MIMO

UL MU-MIMO（上行）是802.11ax中引入的一个重要特性，UL MU-MIMO的概念和UL SU-MIMO的概念类似，都是通过发射机和接收机多天线技术使用相同的信道资源在多个空间流上同时传输数据，唯一的差别点在于UL MU-MIMO的多个数据流是来自多个用户。

{% asset_img UL-MIMO.png %}

802.11ac及之前的802.11标准都是UL SU-MIMO，即只能接受一个用户发来的数据，多用户并发场景效率较低，802.11ax支持UL MU-MIMO后，借助UL OFDMA技术（上行），可同时进行MU-MIMO传输和分配不同RU进行多用户多址传输，提升多用户并发场景效率，大大降低了应用时延。

## 三、更高密度的子载波

载波类似于频域上的 Symbol，一个子载波承载一个 Symbol。
在Wi-Fi 5及以前（802.11a/b/g/n/ac），子载波宽度是312.5KHz。以HT20（20MHz带宽）为例，其被划分为64个子载波，其中52个用于承载数据，4个用于导频，8个作为保护频带。

{% asset_img subcarrier.png %}

### 时域帧格式

802.11ax根据不同的用途，时域可以分为4种帧格式。这四种HE PPDU（Presentation Protocol Data Unit，表示协议数据单元）包括HE SU-PPDU（单用户）、HE MU-PPDU（多用户）、HE Extended Range SU-PPDU（扩展的单用户协议）以及基于Trigger的HE PPDU。
高效的前导则包含HE-SIG-A、HE-SIG-B（可选）、HE-STF和HE-LTF。其中HE-LTF主要是用来做信道估计和MIMO检测。

### 频域资源单位RU

对于802.11ax，子载波密度提高了4倍，包含256个子载波，其宽度也缩小为78.125KHz，并基于 OFDMA 模式以 RU 为单位分配频率资源，最小RU为包含26个子载波的2MHz带宽，此外还有52、106、242、484或996数量的子载波。

下图是20MHz和40MHz带宽的 RU 帧结构图，以最常见的第一行为例，总共256个子载波中，有效子载波为234个（9个包含26个子载波的RU），此外还有首尾11个保护载波 、4个导频载波、7个中央直流载波。

{% asset_img ru.jpeg %}

> 蓝色部分是有效子载波，其它颜色是导频（橙黄色）、直流（DC）和保护子载波（edge）
> 除了信道中央位置的直流载波，资源单位是相邻和连续的

## 四、更高效率的调制编码策略

调制编码，分为调制和编码两部分，它们共同决定了单位时间可以同时发送的比特数。其中：

- 调制方式：规定每次能够同时发送的比特数，例如BPSK、QPSK、16QAM，64QAM和256QAM
- 码率：有用的数据在编码后总数据量中的占比。如果码率是3/4，就是指编码后的数据中，3位数据比特 + 1位冗余比特。

我们一般将调制和编码两部分组合起来分为多个等级，级别越高，数据发送的速率也就越快，这就是调制编码策略 MCS（Modulation Coding Scheme）。
802.11ac的基础MSC如下表：

{% asset_img ac-msc.png %}

802.11ac的常见速率 867Mbps = 433.3 Mbps \* 2，此时采用 2*2 MIMO，工作在MSC 9模式（80MHz传输带宽、256-QAM调制模式、0.4us保护间隔、5/6的编码方式）。

802.11ax的基础MSC如下表：

{% asset_img ax-msc.png %}

上表是基于单流的数据，MIMO速率就是直接乘上通道数量。
802.11ax的理论最大速率 9.6Gbps = 1201 Mbps \* 8，此时采用 8*8 MIMO，工作在MSC 11模式（160MHz传输带宽、1024-QAM调制模式、0.8us保护间隔、5/6的编码方式）。

### 256QAM --> 1024QAM

常用的调制方式包括BPSK、QPSK、16QAM，64QAM和256QAM，能同时发送的比特数为1个，2个，4个，6个和8个。
802.11ac 协议采用最高 256-QAM 正交幅度调制，即每个符号可以传输 8bit 数据。

{% asset_img QAM.png %}

802.11ax 协议采用最高 1024-QAM 正交幅度调制，即每个符号可以传输 10bit 数据，10bit/8bit=1.25，因此相对于 802.11ac 来说，802.11ax 的速率会提升 25%。

> 高通已提供4096-QAM，理论速率提高20%，也称为MCS12~MCS13，但最大仅支持2*2 MIMO，同时终端支持也非常有限

### 更长的 Symbol 时长 + 更短的 GI 间隔

Symbol就是时域上的传输信号，相邻的两个Symbol之间需要有一定的空隙（GI），以避免Symbol之间的干扰。就像中国的高铁一样，每列车相当于一个Symbol，同一个车站发出的两列车之间一定要有一个时间间隙，否则两列车就可能会发生碰撞。不同Wi-Fi标准下的间隙也有不同，一般来说传输速率较快时GI需要适当增大，就像同一车道上两列350KM/h时速的高铁发车时间间隙要比时速250KM/h时速的高铁发车间隙要大一些。

对于 802.11ac，Symbol的有效传输时长为3.2us，GI 有0.4us 和 0.8us 的两种模式。
对于 802.11ax 由于子载波密度提高了4倍，Symbol的有效传输时长提高到 3.2 * 4 = 12.8us，GI 提高到 0.8us 和 1.6us。换句话说，Wi-Fi 6 的传输容量提高了4倍，但信号间隔只提高了2倍，因此传输效率又了显著提升。

在 GI 同为 800ns 的情况下，对于 802.11ac来说：
    每个 Symbol 的传输时间为(3.2+0.8)=4.0us，有效数据传输时间占比为 3.2/4.0=0.8，
而对于 802.11ax 来说：
    每个 Symbol 的传输时间为(12.8+0.8)=13.6us，有效数据传输时间占比为 12.8/13.6=0.94。

## 五、BSS Coloring - 着色机制

Wi-Fi射频的传输原理是在任何指定时间内，一个信道上只允许一个用户传输数据，如果Wi-Fi AP和客户端在同一信道上侦听到有其他802.11无线电传输，则会自动进行冲突避免，推迟传输，因此每个用户都必须轮流使用（这就是CSMA/CA的原理）。
802.11ac及之前的标准，通常采用动态调整CCA门限的机制来改善同频信道间的干扰，通过识别同频干扰强度，动态调整CCA门限，忽略同频弱干扰信号实现同频并发传输，提升系统吞吐容量。

Spatial Reuse（空间复用），也被称作“BSS着色”（BSS coloring），通过此技术可以实现更多同步传输，即AP可以识别两个相距不远但并不相邻的AP和终端设备，能够在同一时间内实现无线并发传输而不会相互影响。用于解决不同AP在相同信道下并发冲突的问题。

> BSS着色技术来源于 802.11ah，由于其应用的室外场景往往多个AP同时工作，利用BSS染色技术可以快速检测网络环境以减少干扰

{% asset_img obss.jpeg %}

- 当路由器或设备在发送数据前侦听到信道已被占用时，会首先检查该“占用”的BSS Color（**此处可以看出 BSS Color 是要优先于 MAC address判断的**），确定是否是同一AP的网络，如果不是，则不用避让，从而允许多个AP在同一信道上运行，并智能管理多用户同时并行传输
- 采用BSS着色机制，接收端可以及早识别同频传输干扰信号并停止接收，避免浪费收发机时间。如果颜色相同，则认为是同一BSS内的干扰信号，发送将推迟；如果颜色不同，则认为两者之间无干扰，两个Wi-Fi设备可同信道同频并行传输。

## 六、TWT - 目标唤醒时间

目标唤醒时间（TWT）是802.11ax支持的另一个重要的资源调度功能，它借鉴于**802.11ah**标准。它允许设备协商什么时候和多久会被唤醒，然后发送或接收数据。
此外，Wi-Fi AP可以将客户端设备分组到不同的TWT周期，从而减少唤醒后同时竞争无线介质的设备数量。TWT还增加了设备睡眠时间，对采用电池供电的终端来说，大大提高了电池寿命。

## 七、新的安全标准WPA3

面前主流的Wi-Fi安全标准WEP2已经发布20多年了（之前更古老的是WPA和WEP，以及未流行的WAPI），存在许多明显的安全隐患，为此Wi-Fi联盟发布了新的安全标准WPA3，主要特性是：

- 建立了 Wi-Fi设备配置协议（DPP），WPA3不需要使用共享密码即可注册新设备，从而摆脱了对屏幕和键盘输入的依赖，特别适用于智能灯泡等物联网设备。实现方式是用户使用二维码或NFC标签，通过拍摄照片或接收来自于路由器的无线电信号，以传输系统访问权限的方式获得相应的网络授权，而非通过屏幕输入密码。
- 提供“个性化数据加密”功能，当您连接到开放的Wi-Fi网络时，即使您在连接时未输入密码，设备与Wi-Fi接入点之间的流量也会被加密
- 字典攻击不再可用，因为WPA 3安全协议会限制错误密码次数，从而击败基于字典爆破的尝试
- 加密强度升到了192位（CNSA标准）
- 修正了KRACK（重装密钥攻击）问题

由于WPA3的实现需要AP和终端设备的共同改造，目前还没有实现大规模的商业普及！

## 八、小结

{% asset_img phy.png %}

## 九、展望 Wi-Fi 7

IEEE 802.11be是计划中802.11 IEEE标准的下一个版本，将会命名为Wi-Fi 7，预计2024年发布。

候选特性：

- **支持全新的6GHz频谱**，并适配相应的监管法规
- 支持320MHz的信道宽度，高效地利用充裕的频谱
- 支持16个空间流，多输入多输出 (MIMO) 协议改进
- 支持全新的 4096-QAM (4K-QAM)
- 新的帧格式，改进的前向兼容
- 多带宽／多信道聚合运作，对拥塞和频谱和充裕的频谱分别引入 320/160+160 MHz 和 240/160+80 MHz 带宽，
- 接入点 (AP) 间协调（传输协调与联合传输）
- 更高级的链路适应和重新传输协议，例如混合自动重请求 (HARQ)
- 集成时效性网络 (TSN) 扩展，应对低时延实时流量 (IEEE 802.11aa)
- 改进正交频分多址的资源分配
- 改进信道探测，降低探测时间，隐式信道探测，更灵活的 preamble puncturing 方法
- 对直接链路的支持，由接入点主导

## 附录：名词解释

|缩略语|英文全名|中文解释|
|-|-|-|
|OFDMA|Orthogonal Frequency Division Multiple Access|正交频分多址接入|
|HE|Hight Efficiency |高效率|
|PPDU |physical layer (PHY) protocol data unit |物理层协议数据单元|
|RU |Resource Unit |资源单元|
|OBSS |Overlapping Basic Service Sets |重叠基本服务集|
|SR |Spatial Reused |空间重用|
|TWT |Target Wake Times |目标唤醒时间|
|BPSK |Binary Phase Shift Keying|二相相移键控 |
|QPSK |Quadrature Phase Shift Keying |四相相移键控信号|
|QAM |Quadrature Amplitude Modulation |正交幅度调制 ,16QAM是指包含16种符号的QAM调制方式，256QAM，1024QAM等类似 |

---

## 参考文献

- [IEEE 802.11 的 Wiki](https://zh.wikipedia.org/wiki/IEEE_802.11)
- [Intel关于Wifi 6的介绍](https://www.intel.cn/content/www/cn/zh/gaming/resources/wifi-6.html)
- [关于WiFi 6技术，这篇说得最详细](http://www.semiinsights.com/s/electronic_components/23/38911.shtml)
- [什么是调制、为什么要调制、调制有哪些？](https://zhuanlan.zhihu.com/p/373074671)
- [数字调制技术的对比分析](https://www.elettroamici.org/zh/modulazione-digitale/)
- [第七代无线技术802.11ax详解](https://www.ruijie.com.cn/fa/xw-hlw/81858/)
- [Wi-Fi 技术的演进](https://www.eet-china.com/mp/a44484.html)
- [WIFI6技术概述](https://zhuanlan.zhihu.com/p/359250747)
- [802.11ax（Wi-Fi 6）技术简介和射频测试](https://www.mwrf.net/tech/tm/2021/28003.html)

### 资料下载

- [IEEE 802.11ax 技术白皮书 - H3C](80211ax技术白皮书.pdf)
