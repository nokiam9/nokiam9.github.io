---
title: VPC网络规划的关键技术分析
date: 2021-06-27 11:38:49
tags:
---

## VxLan VS VLan

VPC网络的核心是VxLan技术，必须支持海量租户之间的网络隔离。

## 网络ACL VS 安全组

防火墙主要是做南北向的访问控制，作用范围是VPC及其子网；安全组主要是做东西向的访问控制，作用范围是虚拟机网卡。

{% asset_img vpc-infra.png %}

> 从流量的角度来看，VPC访问路径依次是：
外部网络 --> VPC路由器 --> 所在子网的ACL过滤--> 虚拟机网卡的安全组过滤 --> 业务应用

### ACL的工作方式

- 防火墙作用在VPC路由器上，属于集中式的VPC边缘设备，为整个VPC提供访问控制。防火墙的配置是动态生效的，即时的配置会马上作用到VPC路由器接口；
- 数据包进入防火墙时，根据规则集的规则优先级进行逐条匹配，如果匹配上了，则执行规则的行为；如果没有匹配上，则执行规则集的默认行为。
- 防火墙可以针对不同报文状态来进行过滤，如new、established、invalid、related；也可以针对常见的协议，如TCP、UDP、VRRP、ICMP等。同时，如果协议是TCP或者ICMP，防火墙提供了更加细粒度的过滤规则，能够针对ICMP的类型、TCP的flag进行匹配，进一步细化策略，满足更多的使用场景。

### 安全组的工作方式

- 安全组作用于虚拟机的虚拟网卡上，给虚拟机提供三层网络的访问控制，支持入方向、出方向的过滤；
- 安全组是一个分布式的访问控制，可以对TCP/UDP/ICMP等协议进行有效过滤；也可以直接匹配所有协议；可以根据数据包的源IP进行过滤。

### 小结

从安全的角度来看，在离威胁源更近的地方进行防护是更好的方式。
一般来说，南北向交给防火墙来做，安全组作为防火墙的补充，是云主机安全的最后防线。
安全组和防火墙是相辅相成的，两者有机结合，才能够更好的做云主机的安全防护。

{% asset_img vs.png %}

---

## 参考文献

- [安全组和云防火墙的区别](https://zhuanlan.zhihu.com/p/86734727)
